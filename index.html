<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NASCAR Live Feed with Points and Season Totals</title>
</head>
<body>

<!-- Lap Number Table -->
<h2>Lap Number: <span id="lapNumber"></span></h2>

<h2>Vehicle Data</h2>
<table border="1">
  <thead>
    <tr>
      <th>Vehicle Number</th>
      <th>Driver</th>
      <th>Owner</th>
    </tr>
  </thead>
  <tbody id="liveFeedData"></tbody>
</table>

<p>Last Updated: <span id="lastUpdate"></span></p>

<!-- Owner Points Table -->
<h2>Owner Points Table</h2>
<table border="1">
  <thead>
    <tr>
      <th>Owner</th>
      <th>Driver</th>
      <th>Points Earned This Race</th>
      <th>Season Total Points</th>
    </tr>
  </thead>
  <tbody id="ownerPointsTable"></tbody>
</table>

<p>Last Updated: <span id="lastUpdatePoints"></span></p>

<script>
  // Owner-Driver Mapping with Season Totals
  const ownerDriverMapping = {
    "Kyle Larson": { owner: "David Lee Grobe", seasonTotal: 1200 },
    "William Byron": { owner: "Brian Rye (#2)", seasonTotal: 1250 },
    "Tyler Reddick": { owner: "Mark Almaguer", seasonTotal: 1150 },
    "Christopher Bell": { owner: "Bobby Grobe (#2)", seasonTotal: 1225 },
    "Ryan Blaney": { owner: "Susan Grobe", seasonTotal: 1185 },
    "Denny Hamlin": { owner: "Billy Grobe", seasonTotal: 1240 },
    "Kyle Busch": { owner: "Jeff Lindhorst", seasonTotal: 1105 },
    "Ty Gibbs": { owner: "Bobby Grobe (#1)", seasonTotal: 980 },
    "Martin Truex Jr.": { owner: "Daniel Grobe", seasonTotal: 1120 },
    "Ross Chastain": { owner: "Austin Rye", seasonTotal: 1085 },
    "Chase Elliott": { owner: "Travis Penny", seasonTotal: 1195 },
    "Bubba Wallace": { owner: "Tommy Rye", seasonTotal: 1160 },
    "Joey Logano": { owner: "Connor Rye", seasonTotal: 1210 },
    "Chris Buescher": { owner: "Brian Rye (#1)", seasonTotal: 1100 },
    "Alex Bowman": { owner: "Kris Rye", seasonTotal: 1130 }
  };

  // Fetch live race feed (Lap and Vehicle Data)
  function fetchLiveFeed() {
    fetch('https://cf.nascar.com/live/feeds/live-feed.json')  // Replace with actual URL
      .then(response => response.json())
      .then(data => {
        const lapNumberElement = document.getElementById('lapNumber');
        const liveFeedData = document.getElementById('liveFeedData');
        const lastUpdateElement = document.getElementById('lastUpdate');
        
        if (data && data.lap_number && Array.isArray(data.vehicles)) {
          lapNumberElement.textContent = data.lap_number;
          lastUpdateElement.textContent = new Date().toLocaleTimeString();

          // Clear existing table rows
          liveFeedData.innerHTML = '';

          // Populate table with vehicle numbers, drivers, and owners
          data.vehicles.forEach(vehicle => {
            const driverName = vehicle.driver.full_name;
            const ownerInfo = ownerDriverMapping[driverName] || { owner: 'Unknown', seasonTotal: 0 };

            const row = document.createElement('tr');
            row.innerHTML = `<td>${vehicle.vehicle_number}</td><td>${driverName}</td><td>${ownerInfo.owner}</td>`;
            liveFeedData.appendChild(row);
          });
        } else {
          console.error('Invalid JSON structure or missing data.');
        }
      })
      .catch(error => console.error('Error fetching live feed:', error));
  }

  // Fetch live points feed (Owner Points Data)
  function fetchPointsFeed() {
    fetch('https://cf.nascar.com/live/feeds/series_1/5424/live_points.json')  // Actual URL
      .then(response => response.json())
      .then(data => {
        const ownerPointsTable = document.getElementById('ownerPointsTable');
        const lastUpdatePointsElement = document.getElementById('lastUpdatePoints');
        lastUpdatePointsElement.textContent = new Date().toLocaleTimeString();

        // Clear the table
        ownerPointsTable.innerHTML = '';

        if (Array.isArray(data)) {
          // Populate table with owner, driver, and points earned this race and update season total
          data.forEach(vehicle => {
            const driverName = `${vehicle.first_name} ${vehicle.last_name.split(" (")[0]}`;  // Extract driver name without "(P)"
            const pointsEarned = vehicle.points_earned_this_race || 0;

            if (ownerDriverMapping[driverName]) {
              const ownerInfo = ownerDriverMapping[driverName];
              ownerInfo.seasonTotal += pointsEarned;  // Update season total

              // Create a new row for the owner points table
              const row = document.createElement('tr');
              row.innerHTML = `<td>${ownerInfo.owner}</td><td>${driverName}</td><td>${pointsEarned}</td><td>${ownerInfo.seasonTotal}</td>`;
              ownerPointsTable.appendChild(row);
            }
          });
        } else {
          console.error('Invalid points data structure.');
        }
      })
      .catch(error => console.error('Error fetching points feed:', error));
  }

  // Initial fetch for both tables
  fetchLiveFeed();
  fetchPointsFeed();

  // Set interval for auto-updating every 60 seconds
  setInterval(fetchLiveFeed, 60000);
  setInterval(fetchPointsFeed, 60000);
</script>

</body>
</html>
